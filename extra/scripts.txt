CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS vector;

-- USER PROFILE
CREATE TABLE user_profile (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  telegram_id BIGINT UNIQUE NOT NULL,
  timezone TEXT DEFAULT 'Africa/Nairobi'
);

-- CONVERSATIONS
CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  created_at TIMESTAMP DEFAULT NOW(),
  user_id UUID REFERENCES user_profile(id),
  role TEXT NOT NULL, -- user / assistant
  message_text TEXT NOT NULL,
  embedding VECTOR(1536)
);

CREATE INDEX idx_conversations_created
ON conversations(created_at DESC);